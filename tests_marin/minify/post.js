function getCookie(e){let o=e+"=",n=decodeURIComponent(document.cookie).split(";");for(let e=0;e<n.length;e++){let t=n[e];for(;" "==t.charAt(0);)t=t.substring(1);if(0==t.indexOf(o))return t.substring(o.length,t.length)}return""}async function compressPhoto(e){const o=JSON.stringify({photo:e});console.log("formDataJsonString ",o),fetch("model/compressPhoto.php",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:o}).then(e=>{e.json().then(function(e){console.log("photo compressée ",e)})})}function showLoader(e){document.getElementById("loaderContainer").style.display="flex",console.log("loader loaded"),setTimeout(()=>{e()},10)}function hideLoader(){document.getElementById("loaderContainer").style.display="none"}$(document).ready(function(){function e(e,o=window.location.href){e=e.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(o);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null}function o(){console.log("postPhoto");let e,o=new FormData,n=$("#media")[0].files[0];return null==n?null:(o.append("media",n),$.ajax({url:"model/postPhoto.php",data:o,processData:!1,contentType:!1,type:"POST",success:function(o){e=o},dataType:"text",async:!1}),console.log(e),"déconnecté"==e?($("#confirmationMessage").html(""),$("#confirmationMessage").html('Votre session a expirée, veuillez <a href="index.php?action=connect" target="_blanck">vous reconnecter</a> puis retenter d\'envoyer le formulaire.'),hideLoader(),!1):e?(console.log("compress 1",Date.now()),compressPhoto(e),console.log("compress 2",Date.now()),e):($("#ConfirmationMessage").html(""),$("#ConfirmationMessage").html("Il y a eu une erreur dans l'envoi de cette photo"),hideLoader(),!1))}function n(e,o){console.log("postModifyAccount"),$.post("model/postModifyAccount.php",{setparam:e,setvalue:o},function(e){console.log(e),console.log("function Received1"),"valid"==e?(window.location.href="index.php?action=connect",console.log("valid !!")):($("#confirmationMessage").html(""),$("#confirmationMessage").text("Il y a une erreur dans un des champs remplis."))},"text")}console.log("ready"),$("#submitSubscribe").click(function(e){e.preventDefault(),console.log("click"),console.log("postSubscribe"),$.post("model/postSubscribe.php",{pseudo:$("#pseudoSubscribe").val(),nom:$("#nom").val(),prenom:$("#prenom").val(),mail:$("#mail").val(),date_naissance:$("#date_naissance").val(),password:$("#password").val(),recaptcha_response:$("#recaptchaResponse").val()},function(e){console.log("function Received"),console.log(e),"valid"==e?(window.location.href="index.php?action=connect",console.log("valid !!")):($("#ConfirmationMessage").html(""),$("#ConfirmationMessage").text("Il y a une erreur dans un des champs remplis."))},"text")}),$("#submitAddPost").click(function(e){e.preventDefault(),console.log("before"),document.getElementById("loaderContainer").style.display="flex",showLoader(()=>{if(console.log("click"),!document.querySelector("input[name=idAnimal]:checked","#addPostForm"))return $("#ConfirmationMessage").html(""),$("#ConfirmationMessage").text("Sélectionnez l'animal pour lequel vous souhaitez poster une image"),void hideLoader();if(null==$("#media")[0].files[0])return $("#ConfirmationMessage").html(""),$("#ConfirmationMessage").text("Vous n'avez pas ajouté d'image !"),void hideLoader();let e=o();(null==e||e)&&function(e){console.log(e),console.log("addpost"),$.post("model/postAddPost.php",{description:$("#description").val(),media:e,idAnimal:document.querySelector("input[name=idAnimal]:checked","#addPostForm").value},function(e){console.log("function Received"),console.log(e),returned=JSON.parse(e),"valid"==returned[0]?(window.location.href="index.php?action=feed&id="+returned[1],console.log("valid 1 !!")):($("#ConfirmationMessage").html(""),$("#ConfirmationMessage").text("L'ajout a échoué"),hideLoader())},"text")}(e)})}),$("#submitNewsletter").click(function(e){e.preventDefault(),console.log("click"),console.log("postAddNewsletter"),$.post("model/postAddNewsletter.php",{prenom:$("#newsletterName").val(),mail:$("#newsletterMail").val()},function(e){console.log("function Received"),console.log(e),"valid"==e?($("#newsletterForm").trigger("reset"),$("#confirmationMessage").html(""),$("#confirmationMessage").text("Vous êtes bien inscrit !"),console.log("valid 1 !!")):($("#confirmationMessageNewsletter").html(""),$("#confirmationMessageNewsletter").text("Cette adresse mail n'est pas valide"))},"text")}),$("#submitAddMessage").click(function(n){n.preventDefault(),document.querySelector("textarea").focus(),document.querySelector("textarea").select(),""==document.querySelector("#msg").value&&""==document.querySelector("#media").value||showLoader(()=>{console.log("click");let n=o();null==n||null==n||n?(!function(o){console.log(o),console.log("addMessage"),$.post("model/postAddMessage.php",{msg:$("#msg").val(),media:o,idconversation:e("id")},function(e){console.log("function Received"),console.log(e),"valid"==e?(console.log("valid 1"),$("#addMessageForm").trigger("reset"),$("#ConfirmationMessage").html("")):($("#ConfirmationMessage").html(""),$("#ConfirmationMessage").text("L'envoi a échoué"))},"text")}(n),document.querySelector("#submitAddMessage").style.animation="flySend 0.75s ease-in-out",setTimeout(()=>{document.querySelector("#submitAddMessage").style.animation=""},750),$("main").animate({scrollTop:document.querySelector("main").scrollHeight},750),hideLoader()):hideLoader()})}),$("#submitAddAnimal").click(function(e){e.preventDefault(),$("#ConfirmationMessage").html(""),console.log("click"),showLoader(()=>{let e=o();(null==e||e)&&(!function(e){console.log("postAddAnimal"),$.post("model/postAddAnimal.php",{nom:$("#nom").val(),media:e,description:$("#description").val(),date_naissance:$("#date_naissance").val(),idtype:$("#idtype").val()},function(e){console.log("function Received"),console.log(e),"valid"==e?(window.location.href="index.php?action=account",console.log("valid !!")):($("#ConfirmationMessage").html(""),$("#ConfirmationMessage").text("Il y a une erreur dans un des champs remplis."))},"text")}(e),hideLoader())})}),$("#submitModifyAccountPseudo").click(function(e){e.preventDefault(),console.log("click"),n("pseudo",$("#pseudoSubscribe").val())}),$("#submitModifyAccountMedia").click(function(e){e.preventDefault(),console.log("click");let n=o();(null==n||n)&&console.log(n)}),$("#submitModifyAccountNom").click(function(e){e.preventDefault(),console.log("click"),n("nom",$("#nom").val())}),$("#submitModifyAccountPrenom").click(function(e){e.preventDefault(),console.log("click"),n("prenom",$("#prenom").val())}),$("#submitModifyAccountMail").click(function(e){e.preventDefault(),console.log("click"),n("mail",$("#mail").val())}),$("#submitModifyAccountDate").click(function(e){e.preventDefault(),console.log("click"),n("date_naissance",$("#date_naissance").val())}),$("#submitModifyAccountPassword").click(function(e){e.preventDefault(),console.log("click"),n("password",$("#password").val())}),$("#submitModifyAnimal").click(function(e){e.preventDefault(),console.log("click");const n=window.location.search,t=new URLSearchParams(n).get("id");let l=o();(null==l||l)&&function(e,o){console.log("postModifyAnimal"),$.post("model/postModifyAnimal.php",{nom:$("#nom").val(),media:e,description:$("#description").val(),date_naissance:$("#date_naissance").val(),idtype:$("#idtype").val(),idAnimal:o},function(e){console.log("function Received"),console.log(e),"valid"==e?console.log("valid !!"):($("#ConfirmationMessage").html(""),$("#ConfirmationMessage").text("Il y a une erreur dans un des champs remplis."))},"text")}(l,t)}),$("#submitConnect").click(function(o){o.preventDefault(),console.log("click"),console.log("postConnect"),$.post("model/postConnect.php",{pseudo:$("#pseudo").val(),password:$("#password").val()},function(o){if(console.log("function Received"),console.log(o),"valid"==o){if(getCookie("quizz")){let e=JSON.parse(getCookie("quizz"));console.log(e),console.log(e.space),$.post("model/postQuizz.php",{space:e.space,secure:e.secure,children:e.children,travel:e.travel,personality:e.personality,animals:e.animals,walk:e.walk,animal1:e.animal1,animal2:e.animal2,animal3:e.animal3},function(e){console.log(e)},"text")}"connect"==e("action")?window.location.href="index.php?action=account":location.reload(),console.log("valid !!")}else $("#ConfirmationMessage").html(""),$("#ConfirmationMessage").text("Il y a une erreur dans un des champs remplis.")},"text")}),$("#addFriend").click(function(e){e.preventDefault(),console.log("addFriend"),console.log("postAddFriend"),$.post("model/postAddFriend.php",{addFriendId:$("#addFriend").val()},function(e){console.log("function Received"),console.log(e),1==e?(location.reload(),console.log("valid !!")):($("#confirmationMessage").html(""),$("#confirmationMessage").text("La demande d'ami n'a pas pu être envoyée."))},"text")}),$("#removeFriend").click(function(e){e.preventDefault(),console.log("removeFriend"),console.log("postRemoveFriend"),$.post("model/postRemoveFriend.php",{removeFriendId:$("#removeFriend").val()},function(e){console.log("function Received"),console.log(e),1==e?(location.reload(),console.log("valid !!")):($("#confirmationMessage").html(""),$("#confirmationMessage").text("La demande n'a pas pu être envoyée."))},"text")}),$("#acceptFriend").click(function(e){e.preventDefault(),console.log("acceptFriend"),console.log("postAcceptFriend"),$.post("model/postAcceptFriend.php",{acceptFriendId:$("#acceptFriend").val()},function(e){console.log("function Received"),console.log(e),1==e?(location.reload(),console.log("valid !!")):($("#confirmationMessage").html(""),$("#confirmationMessage").text("La demande n'a pas pu être envoyée."))},"text")}),$("#submitAjouterRefuge").click(function(e){e.preventDefault(),console.log("click");let n=o();(null==n||n)&&function(e){console.log("postAjouterRefuge"),$.post("model/postAjouterRefuge.php",{nom:$("#nom").val(),description:$("#description").val(),lien:$("#lien").val(),mail:$("#mail").val(),tel:$("#tel").val(),maps:$("#maps").val(),adresse:$("#adresse").val(),logo:e},function(e){console.log("function Received"),console.log(e),"valid"==e?($("#confirmationMessage").html(""),$("#confirmationMessage").text("Le refuge a bien été ajouté.")):($("#confirmationMessage").html(""),$("#confirmationMessage").text("Il y a une erreur dans un des champs remplis."))},"text")}(n)}),$("#submitAjouterAnimalAdopter").click(function(e){e.preventDefault(),console.log("click");let n=o();(null==n||n)&&function(e){console.log("postAjouterAA"),$.post("model/postAjouterAA.php",{nom:$("#nom").val(),sexe:$("#sexe").val(),description:$("#description").val(),idtype:$("#idtype").val(),idrefuge:$("#idrefuge").val(),date_anniversaire:$("#date_anniversaire").val(),unknownAge:$("#unknownAge").val(),photo:e,badge1:$("#badge1").val(),badge2:$("#badge2").val(),badge3:$("#badge3").val()},function(e){console.log("function Received"),console.log(e),"valid"==e?($("#confirmationMessage").html(""),$("#confirmationMessage").text("L'animal à adopter a bien été ajouté.")):($("#confirmationMessage").html(""),$("#confirmationMessage").text("Il y a une erreur dans un des champs remplis."))},"text")}(n)}),$("#deleteRefuge").click(function(e){e.preventDefault(),console.log("click"),console.log("postDeleteRefuge"),$.post("model/postDeleteRefuge.php",{idrefuge:$("#idrefuge").val()},function(e){console.log("function Received"),console.log(e),"valid"==e?($("#confirmationMessageRefuge").html(""),$("#confirmationMessageRefuge").text("Le refuge a bien été supprimé.")):($("#confirmationMessageRefuge").html(""),$("#confirmationMessageRefuge").text("Le refuge n'a pas pu être supprimé."))},"text")}),$("#deleteAA").click(function(e){e.preventDefault(),console.log("click"),console.log("postDeleteAA"),$.post("model/postDeleteAA.php",{idanimal:$("#idanimal").val()},function(e){console.log("function Received"),console.log(e),"valid"==e?($("#confirmationMessageAA").html(""),$("#confirmationMessageAA").text("L'animal à adopter a bien été supprimé.")):($("#confirmationMessageAA").html(""),$("#confirmationMessageAA").text("L'animal à adopter n'a pas pu être supprimé."))},"text")}),$("#submitForgotMail").click(function(e){e.preventDefault(),console.log("click"),console.log("postForgotPassword"),$.post("model/postForgotPassword.php",{mail:$("#forgotMail").val()},function(e){console.log(e),console.log("function Received1"),"valid"==e?(console.log("valid forgot password"),$("#confirmationMessage").html(""),$("#confirmationMessage").text("Vérifiez bien vos spams ! Vous allez recevoir un email pour vous aider à retrouver l'accès à votre compte.")):($("#confirmationMessage").html(""),$("#confirmationMessage").text("Il y a une erreur dans un des champs remplis."))},"text")});let t,l=!1;$("#convSearch").keyup(function(e){if(e.preventDefault(),console.log("convSearch"),!l){l=!0;let e=setInterval(()=>{t!=$("#convSearch").val()&&(t=$("#convSearch").val(),console.log(t),t&&function(e){console.log("postConvSearch"),$.post("model/postConvSearch.php",{convSearch:e},function(e){if(console.log("function Received"),console.log(e),e)try{console.log("try"),$("#confirmationMessage").html(""),$("#messagesContainer").html(""),results=JSON.parse(e),console.log(results);let n=document.getElementById("messagesContainer"),t=document.createElement("h3"),l=document.createTextNode("Amis");function o(e,o,t,l=null){let s=e&&"déconnecté"!=e?e:"defaultProfile.png",i=document.createElement("div"),a=document.createElement("img");i.classList.add("profilePicturesContainer"),a.classList.add("profilePicture"),a.setAttribute("src","./public/images/upload/"+s),i.appendChild(a);let c=document.createElement("div"),r=document.createElement("p");c.classList.add("ConversationTextsContainer");let d=document.createTextNode(o);r.appendChild(d),c.appendChild(r);let u="account";if(l){let e=document.createElement("p"),o=document.createTextNode(l);e.appendChild(o),c.appendChild(e),u="messages"}let p=document.createElement("a");p.setAttribute("href",`index.php?action=${u}&id=${t}`),p.appendChild(i),p.appendChild(c),n.appendChild(p)}t.appendChild(l),n.appendChild(t),console.log("before generateDOM"),console.log("before friend ");let s=0;for(conv of results.friends)s++,console.log(conv),o(conv.photo,conv.pseudo,conv.idconv,conv.lastMessage);if(0==s){console.log("no friend");let e=document.createElement("p"),o=document.createTextNode("Aucun amis trouvé :/");e.appendChild(o),n.appendChild(e)}let i=document.createElement("h3"),a=document.createTextNode("Autres profils");i.appendChild(a),n.appendChild(i);let c=0;for(users of results.others)for(user of(c++,console.log("users"),users))console.log(user.iduser),o(user.photo_user,user.pseudo_user,user.iduser);if(0==c){console.log("no others");let e=document.createElement("p"),o=document.createTextNode("Aucun autre profil trouvé :/");e.appendChild(o),n.appendChild(e)}}catch(e){$("#messagesContainer").html(""),$("#confirmationMessage").html(""),$("#confirmationMessage").text("Nous n'avons trouvé aucune conversation :/")}else $("#messagesContainer").html(""),$("#confirmationMessage").html(""),$("#confirmationMessage").text("Nous n'avons trouvé aucune conversation :/")},"text")}(t))},1e3);setTimeout(()=>{clearInterval(e),l=!1},5e3)}}),offsetCoef=1,$("#loadMoreMessages").click(function(o){console.log("loadMoreMessages"),$.post("model/postLoadMoreMessages.php",{offsetCoef:offsetCoef,id:e("id")},function(e){console.log("function Received"),console.log(e),e?(console.log("valid !!"),$("#chatContainer").prepend(e),offsetCoef+=1):($("#loadMoreMessages").remove(),$("#confirmationMessage").html(""),$("#confirmationMessage").text("Tous les messages ont déjà été chargés."))},"text")}),$("#pseudoSubscribe").keyup(function(){console.log("isPseudoFreeAPI"),$.post("model/isPseudoFreeAPI.php",{checkPseudo:$("#pseudoSubscribe").val()},function(e){console.log("function Received"),console.log(e),1==e?($("#pseudoConfirmationMessage").html(""),$("#pseudoConfirmationMessage").text("Ce pseudo est disponible !")):"2"==e?$("#ConfirmationMessage").html(""):($("#pseudoConfirmationMessage").html(""),$("#pseudoConfirmationMessage").text("Ce pseudo existe déjà !"))},"text")})});